@model IEnumerable<ljp_itsolutions.Models.Promotion>
@{
    Layout = "_Layout";
    ViewData["Title"] = "Campaigns & Active Offers";
}

<div class="container-fluid py-2">
    <!-- Action & Filter Bar -->
    <div class="row g-3 mb-4 align-items-center">
        <div class="col-md-4">
            <div class="input-group shadow-sm rounded-pill overflow-hidden border bg-white text-dark">
                <span class="input-group-text bg-transparent border-0 ps-3">
                    <i class="fas fa-search text-muted"></i>
                </span>
                <input type="text" id="promoSearch" class="form-control border-0 shadow-none ps-2 py-2" placeholder="Search campaigns...">
            </div>
        </div>
        <div class="col-md-3">
            <select id="statusFilter" class="form-select shadow-sm rounded-pill border py-2">
                <option value="">All Statuses</option>
                <option value="Active">Active Now</option>
                <option value="Scheduled">Scheduled</option>
                <option value="Ended">Ended/Paused</option>
            </select>
        </div>
        <div class="col text-end">
            <button class="btn btn-primary rounded-pill px-4 shadow-sm" data-bs-toggle="modal" data-bs-target="#createCampaignModal">
                <i class="fas fa-bullhorn me-2"></i>Provision Campaign
            </button>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0 bg-white border-0">
                <thead class="bg-light bg-opacity-75">
                    <tr>
                        <th class="ps-4 fw-bolder text-muted small text-uppercase py-3 border-0">Campaign Info</th>
                        <th class="fw-bolder text-muted small text-uppercase py-3 border-0">Offer Details</th>
                        <th class="fw-bolder text-muted small text-uppercase py-3 border-0">Validity</th>
                        <th class="fw-bolder text-muted small text-uppercase py-3 border-0">Usage</th>
                        <th class="fw-bolder text-muted small text-uppercase py-3 border-0">Status</th>
                        <th class="pe-4 fw-bolder text-muted small text-uppercase text-end py-3 border-0">Actions</th>
                    </tr>
                </thead>
                <tbody class="border-top-0" id="promoContainer">
                    @foreach (var promo in Model)
                    {
                        var isEnded = promo.EndDate < DateTime.Now;
                        var isUpcoming = promo.StartDate > DateTime.Now;
                        var status = promo.IsActive ? (isEnded ? "Ended" : (isUpcoming ? "Scheduled" : "Active")) : "Ended";
                        var statusClass = status == "Active" ? "bg-success" : (status == "Scheduled" ? "bg-info" : "bg-secondary");

                        <tr class="promo-item transition-hover border-bottom" data-status="@status" style="cursor: pointer;"
                            data-view-name="@promo.PromotionName"
                            data-view-code="@promo.PromotionName.Replace(" ", "").ToUpper()"
                            data-view-discount="@(promo.DiscountType == "Percentage" ? $"{promo.DiscountValue}%" : $"₱{promo.DiscountValue}")"
                            data-view-start="@promo.StartDate.ToString("MMM dd, yyyy")"
                            data-view-end="@promo.EndDate.ToString("MMM dd, yyyy")"
                            data-view-status="@status"
                            data-view-usage="@(promo.MaxRedemptions.HasValue ? $"{promo.Orders?.Count ?? 0} / {promo.MaxRedemptions.Value}" : "Unlimited uses")"
                            data-view-onetime="@promo.OneTimePerCustomer.ToString().ToLower()">
                            
                            <td class="ps-4 py-3">
                                <h6 class="fw-bold text-dark mb-1 search-title">@promo.PromotionName</h6>
                                <p class="text-muted x-small mb-0 search-code">Code: <span class="fw-bold text-primary code-span">@promo.PromotionName.Replace(" ", "").ToUpper()</span></p>
                                <span class="badge bg-light text-dark border px-2 mt-1 fw-bold x-small">@promo.TargetAudience</span>
                            </td>
                            <td class="py-3">
                                <span class="badge bg-primary bg-opacity-10 text-primary px-3 py-2 rounded-pill fw-bold">
                                    @(promo.DiscountType == "Percentage" ? $"{promo.DiscountValue}%" : $"₱{promo.DiscountValue}") OFF
                                </span>
                            </td>
                            <td class="py-3">
                                <div class="d-flex align-items-center gap-2 small">
                                    <i class="far fa-calendar-alt text-primary opacity-50"></i>
                                    <span class="text-dark fw-medium">@promo.StartDate.ToString("MMM dd") — @promo.EndDate.ToString("MMM dd, yy")</span>
                                </div>
                            </td>
                            <td class="py-3">
                                <div class="d-flex flex-column gap-1">
                                    <div class="d-flex align-items-center gap-2 small">
                                        <i class="fas fa-users text-primary opacity-50"></i>
                                        @if (promo.MaxRedemptions.HasValue)
                                        {
                                            <span class="text-dark fw-medium">Used: @(promo.Orders?.Count ?? 0) / @promo.MaxRedemptions.Value</span>
                                        }
                                        else
                                        {
                                            <span class="text-dark fw-medium opacity-75">Unlimited</span>
                                        }
                                    </div>
                                    @if (promo.OneTimePerCustomer)
                                    {
                                        <span class="badge bg-warning bg-opacity-10 text-warning px-2 rounded-pill x-small fw-bold border border-warning border-opacity-25" style="width: fit-content;">1 per customer</span>
                                    }
                                </div>
                            </td>
                            <td class="py-3">
                                @{
                                    var approvalBadge = promo.ApprovalStatus == "Approved" ? "bg-success" : 
                                                       (promo.ApprovalStatus == "Rejected" ? "bg-danger" : "bg-warning");
                                    var approvalIcon = promo.ApprovalStatus == "Approved" ? "fa-check-circle" : 
                                                      (promo.ApprovalStatus == "Rejected" ? "fa-times-circle" : "fa-clock");
                                }
                                <div class="d-flex flex-column gap-1">
                                    <span class="badge rounded-pill @approvalBadge px-2 py-1 x-small fw-bold" style="width: fit-content;">
                                        <i class="fas @approvalIcon me-1"></i>@promo.ApprovalStatus.ToUpper()
                                    </span>
                                    @if (promo.ApprovalStatus == "Approved")
                                    {
                                        <span class="badge rounded-pill @statusClass px-2 py-1 x-small fw-bold" style="width: fit-content;">@status.ToUpper()</span>
                                    }
                                </div>
                            </td>
                            <td class="pe-4 py-3 text-end action-cell">
                                <div class="d-flex gap-2 justify-content-end align-items-center">
                                    <button class="btn btn-light btn-sm rounded-pill fw-bold shadow-none edit-promo-btn px-3 text-muted hvr-light"
                                            data-id="@promo.PromotionID"
                                            data-name="@promo.PromotionName"
                                            data-type="@promo.DiscountType"
                                            data-value="@promo.DiscountValue"
                                            data-start="@promo.StartDate.ToString("yyyy-MM-dd")"
                                            data-end="@promo.EndDate.ToString("yyyy-MM-dd")"
                                            data-active="@promo.IsActive.ToString().ToLower()"
                                            data-max-redemptions="@(promo.MaxRedemptions?.ToString() ?? "")"
                                            data-one-time="@promo.OneTimePerCustomer.ToString().ToLower()"
                                            data-audience="@promo.TargetAudience">
                                        Modify
                                    </button>
                                    <a asp-action="PromotionPerformance" class="btn btn-light btn-sm rounded-pill fw-bold text-primary px-3 hvr-light">
                                        Analytics
                                    </a>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Create Campaign Modal -->
<div class="modal fade" id="createCampaignModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="modal-header border-0 px-4 pt-4 pb-2">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-primary">
                        <i class="fas fa-bullhorn fw-bold"></i>
                    </div>
                    <div>
                        <h5 class="modal-title fw-bolder text-dark mb-0">Provisional Campaign</h5>
                        <p class="text-muted small mb-0 uppercase tracking-widest">Create New Offer</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form asp-action="CreateCampaign" method="post" id="campaignForm">
                    @Html.AntiForgeryToken()
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted uppercase">Campaign Name</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-tag"></i></span>
                            <input name="PromotionName" class="form-control bg-light border-0 py-2" placeholder="e.g. Summer Sale 2026" required />
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted uppercase">Target Audience</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-bullseye"></i></span>
                            <select name="TargetAudience" class="form-select bg-light border-0 py-2">
                                <option value="All Patrons">All Patrons (General Announcement)</option>
                                <option value="VIP/Gold Patrons">VIP/Gold Patrons Only (>1000 pts)</option>
                                <option value="Inactive Patrons">Inactive Patrons (Win-back)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Discount Type</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-percent"></i></span>
                                <select name="DiscountType" class="form-select bg-light border-0 py-2">
                                    <option value="Percentage">Percentage (%)</option>
                                    <option value="Fixed">Fixed Amount (₱)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Face Value</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-coins"></i></span>
                                <input name="DiscountValue" type="number" step="0.01" class="form-control bg-light border-0 py-2" placeholder="0.00" required />
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Start Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="far fa-calendar-alt"></i></span>
                                <input name="StartDate" type="date" class="form-control bg-light border-0 py-2" value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">End Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="far fa-calendar-times"></i></span>
                                <input name="EndDate" type="date" class="form-control bg-light border-0 py-2" value="@DateTime.Now.AddDays(30).ToString("yyyy-MM-dd")" required />
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Max Redemptions <span class="text-muted fw-normal">(Optional)</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-users"></i></span>
                                <input name="MaxRedemptions" type="number" class="form-control bg-light border-0 py-2" placeholder="Leave empty for unlimited" />
                            </div>
                        </div>
                        <div class="col-md-6 d-flex align-items-end mb-2">
                             <div class="form-check form-switch p-2 bg-light rounded-3 w-100">
                                <input class="form-check-input ms-0 me-2" name="OneTimePerCustomer" type="checkbox" value="true" id="createOneTimeSwitch">
                                <label class="form-check-label fw-bold small text-dark mt-1" for="createOneTimeSwitch">1 Use Per Customer</label>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 bg-light rounded-3 border border-light">
                        <div class="form-check form-switch">
                            <input class="form-check-input" name="IsActive" type="checkbox" checked value="true" id="createActiveSwitch">
                            <label class="form-check-label fw-bold text-dark small ms-2" for="createActiveSwitch">Activate Campaign upon Approval</label>
                        </div>
                        <div class="text-muted x-small ms-5 mt-1">If enabled, the promotion will be live as soon as it's approved by a manager.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 px-4 pb-4 pt-0">
                <button type="button" class="btn btn-light rounded-pill px-4 fw-bold flex-fill py-2" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="campaignForm" class="btn btn-primary rounded-pill px-4 fw-bold flex-fill py-2 shadow-sm"><i class="fas fa-plus-circle me-2"></i>Create Campaign</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Campaign Modal -->
<div class="modal fade" id="editCampaignModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="modal-header border-0 px-4 pt-4 pb-2">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-sm bg-info bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-info">
                        <i class="fas fa-edit fw-bold"></i>
                    </div>
                    <div>
                        <h5 class="modal-title fw-bolder text-dark mb-0">Modify Strategic Campaign</h5>
                        <p class="text-muted small mb-0 uppercase tracking-widest">Update Campaign Details</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <form asp-action="EditCampaign" method="post" id="editCampaignForm">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="PromotionID" id="edit-promo-id" />
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted uppercase">Campaign Name</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-tag"></i></span>
                            <input name="PromotionName" id="edit-promo-name" class="form-control bg-light border-0 py-2" required />
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="form-label small fw-bold text-muted uppercase">Target Audience</label>
                        <div class="input-group">
                            <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-bullseye"></i></span>
                            <select name="TargetAudience" id="edit-promo-audience" class="form-select bg-light border-0 py-2">
                                <option value="All Patrons">All Patrons (General Announcement)</option>
                                <option value="VIP/Gold Patrons">VIP/Gold Patrons Only (>1000 pts)</option>
                                <option value="Inactive Patrons">Inactive Patrons (Win-back)</option>
                                <option value="Specific VIP">Specific VIP (Reward)</option>
                            </select>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Discount Type</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-percent"></i></span>
                                <select name="DiscountType" id="edit-promo-type" class="form-select bg-light border-0 py-2">
                                    <option value="Percentage">Percentage (%)</option>
                                    <option value="Fixed">Fixed Amount (₱)</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Face Value</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-coins"></i></span>
                                <input name="DiscountValue" id="edit-promo-value" type="number" step="0.01" class="form-control bg-light border-0 py-2" required />
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Start Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="far fa-calendar-alt"></i></span>
                                <input name="StartDate" id="edit-promo-start" type="date" class="form-control bg-light border-0 py-2" required />
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">End Date</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="far fa-calendar-times"></i></span>
                                <input name="EndDate" id="edit-promo-end" type="date" class="form-control bg-light border-0 py-2" required />
                            </div>
                        </div>
                    </div>
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-muted uppercase">Max Redemptions <span class="text-muted fw-normal">(Optional)</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0 text-muted ps-3"><i class="fas fa-users"></i></span>
                                <input name="MaxRedemptions" id="edit-promo-max" type="number" class="form-control bg-light border-0 py-2" placeholder="Leave empty for unlimited" />
                            </div>
                        </div>
                        <div class="col-md-6 d-flex align-items-end mb-2">
                             <div class="form-check form-switch p-2 bg-light rounded-3 w-100">
                                <input class="form-check-input ms-0 me-2" name="OneTimePerCustomer" type="checkbox" value="true" id="edit-promo-onetime">
                                <label class="form-check-label fw-bold small text-dark mt-1" for="edit-promo-onetime">1 Use Per Customer</label>
                            </div>
                        </div>
                    </div>
                    <div class="p-3 bg-light rounded-3 border border-light">
                        <div class="form-check form-switch">
                            <input class="form-check-input" name="IsActive" id="edit-promo-active" type="checkbox" value="true">
                            <label class="form-check-label fw-bold text-dark small ms-2" for="edit-promo-active">Active Initiative</label>
                        </div>
                        <div class="text-muted x-small ms-5 mt-1">Controls whether this campaign is currently runnable at POS terminals.</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 px-4 pb-4 pt-0">
                <button type="button" class="btn btn-light rounded-pill px-4 fw-bold flex-fill py-2" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="editCampaignForm" class="btn btn-primary rounded-pill px-4 fw-bold flex-fill py-2 shadow-sm"><i class="fas fa-save me-2"></i>Update Campaign</button>
            </div>
        </div>
    </div>
</div>

<!-- View Campaign Modal -->
<div class="modal fade" id="viewDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="modal-header border-0 px-4 pt-4 pb-2">
                <div class="d-flex align-items-center gap-3">
                    <div class="avatar-sm bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center text-primary border border-primary border-opacity-25">
                        <i class="fas fa-bullhorn fw-bold"></i>
                    </div>
                    <div>
                        <h5 class="modal-title fw-bolder text-dark mb-0" id="vd-name">Campaign Details</h5>
                        <p class="text-muted small mb-0 uppercase tracking-widest fw-bold text-primary" id="vd-code">CODE</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4 pt-3">
                <div class="bg-light rounded-4 p-4 text-center mb-4 border border-white shadow-sm">
                    <span class="h1 fw-bolder text-primary mb-0" id="vd-discount">0%</span>
                    <span class="fw-bold text-muted small ms-1 uppercase tracking-wider">Discount</span>
                </div>
                
                <div class="row g-4">
                    <div class="col-6">
                        <label class="text-muted small fw-bold uppercase tracking-widest mb-1 d-block">Start Date</label>
                        <div class="d-flex align-items-center gap-2">
                            <i class="far fa-calendar-alt text-primary opacity-50"></i>
                            <span class="text-dark fw-bold" id="vd-start"></span>
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="text-muted small fw-bold uppercase tracking-widest mb-1 d-block">End Date</label>
                        <div class="d-flex align-items-center gap-2">
                            <i class="far fa-calendar-times text-primary opacity-50"></i>
                            <span class="text-dark fw-bold" id="vd-end"></span>
                        </div>
                    </div>
                    <div class="col-6">
                        <label class="text-muted small fw-bold uppercase tracking-widest mb-1 d-block">Current Status</label>
                        <span class="badge bg-success rounded-pill px-3 py-2 fw-bold text-uppercase" id="vd-status">ACTIVE</span>
                    </div>
                    <div class="col-6">
                        <label class="text-muted small fw-bold uppercase tracking-widest mb-1 d-block">Redemptions</label>
                        <div class="d-flex align-items-center gap-2">
                            <i class="fas fa-users text-primary opacity-50"></i>
                            <span class="text-dark fw-bold" id="vd-usage"></span>
                        </div>
                    </div>
                </div>
                <div class="mt-4 p-3 bg-warning bg-opacity-10 rounded-3 d-none border border-warning border-opacity-25" id="vd-onetime-container">
                    <div class="d-flex align-items-center gap-2">
                        <i class="fas fa-user-shield text-warning border border-warning p-1 rounded-circle bg-white"></i>
                        <span class="text-warning fw-bolder small uppercase tracking-widest">Strictly 1 Use Per Customer</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 px-4 pb-4 pt-0">
                <button type="button" class="btn btn-light rounded-pill px-4 fw-bold flex-fill py-3" data-bs-dismiss="modal">Close Details</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            function filterPromos() {
                var searchTerm = $('#promoSearch').val().toLowerCase();
                var statusFilter = $('#statusFilter').val();

                $('.promo-item').each(function() {
                    var item = $(this);
                    var title = item.find('.search-title').text().toLowerCase();
                    var code = item.find('.code-span').text().toLowerCase();
                    var status = item.data('status');

                    var matchesSearch = title.includes(searchTerm) || code.includes(searchTerm);
                    var matchesStatus = statusFilter === "" || status === statusFilter;

                    if (matchesSearch && matchesStatus) {
                        item.show();
                    } else {
                        item.hide();
                    }
                });

                if ($('.promo-item:visible').length === 0) {
                    if ($('#noResults').length === 0) {
                        $('#promoContainer').append('<tr id="noResults"><td colspan="6" class="text-center py-5 text-muted border-0"><i class="fas fa-bullhorn fa-3x mb-3 opacity-25"></i><p>No campaigns match your specific criteria.</p></td></tr>');
                    }
                } else {
                    $('#noResults').remove();
                }
            }

            $('#promoSearch').on('keyup', filterPromos);
            $('#statusFilter').on('change', filterPromos);

            $('.edit-promo-btn').click(function() {
                const id = $(this).data('id');
                const name = $(this).data('name');
                const type = $(this).data('type');
                const value = $(this).data('value');
                const start = $(this).data('start');
                const end = $(this).data('end');
                const active = $(this).data('active');
                const maxRedemps = $(this).data('max-redemptions');
                const oneTime = $(this).data('one-time');
                const audience = $(this).data('audience');

                $('#edit-promo-id').val(id);
                $('#edit-promo-name').val(name);
                $('#edit-promo-type').val(type);
                $('#edit-promo-value').val(value);
                $('#edit-promo-start').val(start);
                $('#edit-promo-end').val(end);
                $('#edit-promo-active').prop('checked', active);
                $('#edit-promo-max').val(maxRedemps);
                $('#edit-promo-onetime').prop('checked', oneTime);
                $('#edit-promo-audience').val(audience || "All Patrons");

                const editModalEl = document.getElementById('editCampaignModal');
                const editModal = bootstrap.Modal.getInstance(editModalEl) || new bootstrap.Modal(editModalEl);
                editModal.show();
            });

            // Prevent modal from opening when clicking buttons
            $('.action-cell, .action-cell button, .action-cell a').click(function(e) {
                e.stopPropagation();
            });

            // View Details Modal Trigger
            $('.promo-item').click(function() {
                var btn = $(this);
                $('#vd-name').text(btn.data('view-name'));
                $('#vd-code').text("CODE: " + btn.data('view-code'));
                $('#vd-discount').text(btn.data('view-discount'));
                $('#vd-start').text(btn.data('view-start'));
                $('#vd-end').text(btn.data('view-end'));
                $('#vd-usage').text(btn.data('view-usage'));

                // Status Badge coloring
                var status = btn.data('view-status');
                var statusBadge = $('#vd-status');
                statusBadge.text(status);
                statusBadge.removeClass('bg-success bg-info bg-secondary');
                if (status === 'Active') statusBadge.addClass('bg-success');
                else if (status === 'Scheduled') statusBadge.addClass('bg-info');
                else statusBadge.addClass('bg-secondary');

                if (btn.data('view-onetime') === true) {
                    $('#vd-onetime-container').removeClass('d-none');
                } else {
                    $('#vd-onetime-container').addClass('d-none');
                }

                new bootstrap.Modal(document.getElementById('viewDetailsModal')).show();
            });
        });
    </script>
}

<style>
    .border-top-glow { border-top: 4px solid var(--glow-color) !important; }
    .x-small { font-size: 0.75rem; }
    .uppercase { text-transform: uppercase; }
    .tracking-wider { letter-spacing: 0.1em; }
    .tracking-widest { letter-spacing: 0.1em; }
    .hvr-light:hover { background-color: #f8fafc !important; border-color: #e2e8f0 !important; }
    .avatar-sm { width: 48px; height: 48px; min-width: 48px; }
</style>
