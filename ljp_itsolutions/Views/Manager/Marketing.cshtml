@model ljp_itsolutions.Services.MarketingDashboardData
@{
    ViewData["Title"] = "Marketing Strategic Intelligence";
    var performance = ViewBag.Performance as IEnumerable<dynamic>;
}

<div class="container-fluid py-4">
    <!-- Header Row -->
    <div class="row mb-4 align-items-center">
        </div>
        <div class="col-md-6 text-md-end">
            <button onclick="location.href='@Url.Action("ExportTacticalROI", "Marketing")'" class="btn btn-primary rounded-pill px-4 shadow-sm fw-bold">
                <i class="fas fa-file-export me-2"></i>Export Performance Data
            </button>
        </div>
    </div>

    <!-- Marketing KPIs -->
    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden" style="border-left: 3px solid #0dcaf0 !important;">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-muted x-small fw-bold text-uppercase tracking-wider mb-1">Active Campaigns</p>
                            <h4 class="fw-bold mb-0">@ViewBag.ActivePromos</h4>
                            <span class="text-info xx-small"><i class="fas fa-bullhorn me-1"></i>Live Now</span>
                        </div>
                        <div class="bg-info bg-opacity-10 rounded-3 p-2 text-info">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden" style="border-left: 3px solid #198754 !important;">
                 <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-muted x-small fw-bold text-uppercase tracking-wider mb-1">Promo Uses</p>
                            <h4 class="fw-bold mb-0">@ViewBag.TotalPromoUses</h4>
                            <span class="text-success xx-small"><i class="fas fa-check-circle me-1"></i>Redemptions</span>
                        </div>
                        <div class="bg-success bg-opacity-10 rounded-3 p-2 text-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden" style="border-left: 3px solid #dc3545 !important;">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-muted x-small fw-bold text-uppercase tracking-wider mb-1">Avg. Discount</p>
                            <h4 class="fw-bold mb-0">₱@ViewBag.AvgDiscount.ToString("N1")</h4>
                            <span class="text-danger xx-small"><i class="fas fa-tag me-1"></i>Per Order</span>
                        </div>
                        <div class="bg-danger bg-opacity-10 rounded-3 p-2 text-danger">
                            <i class="fas fa-tag"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm rounded-4 h-100 overflow-hidden" style="border-left: 3px solid #0d6efd !important;">
                <div class="card-body p-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <p class="text-muted x-small fw-bold text-uppercase tracking-wider mb-1">Promo Revenue</p>
                            <h4 class="fw-bold mb-0">₱@ViewBag.TotalPromoRevenue.ToString("N0")</h4>
                            <span class="text-primary xx-small">Campaign Driven</span>
                        </div>
                        <div class="bg-primary bg-opacity-10 rounded-3 p-2 text-primary">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Strategic Analytics Row 1 -->
    <div class="row g-4 mb-4">
        <!-- Growth Chart -->
        <div class="col-lg-8">
            <div class="card border shadow-sm rounded-4 overflow-hidden h-100">
                <div class="card-header bg-white py-3">
                    <h6 class="fw-bold mb-0 text-dark">Engagement Velocity & Conversion Trends</h6>
                    <p class="text-muted xx-small mb-0">Aggregate conversion volume over the trailing 7-day period</p>
                </div>
                <div class="card-body p-4">
                    <div style="height: 300px;">
                        <canvas id="performanceChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patron Composition -->
        <div class="col-lg-4">
            <div class="card border shadow-sm rounded-4 overflow-hidden bg-white h-100">
                <div class="card-header bg-white border-0 py-3 px-4">
                    <h6 class="fw-bold mb-0 text-dark">Patron Acquisition Matrix</h6>
                    <p class="text-muted xx-small mb-0">New vs. returning loyalty retention share</p>
                </div>
                <div class="card-body p-4 pt-0">
                    <div style="height: 250px;">
                        <canvas id="patronChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Strategic Analytics Row 2 -->
    <div class="row g-4 mb-4">
        <!-- VIP Loyalty Equity -->
        <div class="col-lg-4">
            <div class="card border shadow-sm rounded-4 overflow-hidden bg-white h-100">
                <div class="card-header bg-white border-0 py-3 px-4">
                    <h6 class="fw-bold mb-0 text-dark">VIP Loyalty Equity</h6>
                    <p class="text-muted xx-small mb-0">Highest capitalized patrons by engagement points</p>
                </div>
                <div class="card-body p-4 pt-0">
                    <div style="height: 300px;">
                        <canvas id="vipEquityChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tier Saturation -->
        <div class="col-lg-8">
            <div class="card border shadow-sm rounded-4 overflow-hidden bg-white h-100">
                <div class="card-header bg-white border-0 py-3 px-4">
                    <h6 class="fw-bold mb-0 text-dark">Strategic Tier Saturation Index</h6>
                    <p class="text-muted xx-small mb-0">Cross-demographic distribution of loyalty tier achievement</p>
                </div>
                <div class="card-body p-4 pt-0">
                    <div style="height: 300px;">
                        <canvas id="tierSaturationChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const primaryColor = '#4f46e5';
            const secondaryColor = '#fbbf24';

            // Evolution Analytics
            new Chart(document.getElementById('performanceChart').getContext('2d'), {
                type: 'line',
                data: {
                    labels: @Html.Raw(Json.Serialize(Model.PerformanceLabels)),
                    datasets: [{
                        label: 'Conversion Velocity',
                        data: @Html.Raw(Json.Serialize(Model.PerformanceData)),
                        borderColor: primaryColor,
                        backgroundColor: 'rgba(79, 70, 229, 0.05)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });

            // Acquisition Matrix
            new Chart(document.getElementById('patronChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['New Patrons', 'Returning'],
                    datasets: [{
                        data: [@Model.NewPatronsCount, @Model.ReturningPatronsCount],
                        backgroundColor: ['#3b82f6', '#6366f1'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '75%',
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } }
                    }
                }
            });

            // VIP Equity
            new Chart(document.getElementById('vipEquityChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: @Html.Raw(Json.Serialize(Model.VIPPerformance.Select(v => v.FullName))),
                    datasets: [{
                        data: @Html.Raw(Json.Serialize(Model.VIPPerformance.Select(v => v.Points))),
                        backgroundColor: primaryColor,
                        borderRadius: 8
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });

            // Tier Saturation
            new Chart(document.getElementById('tierSaturationChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: @Html.Raw(Json.Serialize(Model.TierLabels)),
                    datasets: [{
                        label: 'Patron Volume',
                        data: @Html.Raw(Json.Serialize(Model.TierData)),
                        backgroundColor: ['#e67e22', '#6366f1', '#94a3b8', '#e2e8f0'],
                        borderRadius: 12
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } }
                }
            });
        });
    </script>
}

<style>
    .x-small { font-size: 0.75rem; }
    .xx-small { font-size: 0.65rem; }
    .uppercase { text-transform: uppercase; }
    .tracking-wider { letter-spacing: 0.05em; }
</style>
